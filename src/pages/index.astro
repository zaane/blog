---
import "../styles/global.css";
import Nav from "../components/Nav.astro";
import Projects from "../components/Projects.astro";
import SEO from "../components/SEO.astro";
import { getCollection } from "astro:content";
import type { Project, ProjectSectionId } from "../types/projects";

const pageTitle = "Home | Zane Olds";
const pageDescription =
  "Portfolio of Zane Olds: teacher, learner, and software creator building educational software.";
const basePath = import.meta.env.BASE_URL.endsWith("/")
  ? import.meta.env.BASE_URL
  : `${import.meta.env.BASE_URL}/`;
const iconHref = `${basePath}orca.svg`;

const sectionOrder: ProjectSectionId[] = ["current", "past", "guided"];

const sectionMeta: Record<
  ProjectSectionId,
  { title: string; description: string }
> = {
  current: {
    title: "Current Projects",
    description: "",
  },
  past: {
    title: "Past Projects",
    description:
      "Things I'm not working on currently, but that I intend to pick back up in the future. Most of them are in a half-stack state, and some have drafts of blog write-ups that I want to finish so I can share my thoughts and working process.",
  },
  guided: {
    title: "Courses and Guided Projects",
    description:
      "Guided builds and courses I completed to develop specific skills or to learn about the inner workings of tools I use every day. This is not a comprehensive list of materials I've learned from, but rather a curation of those that have had the most impact on me and that I feel confident recommending to others looking to learn the same topics or skills.",
  },
};

const projectsByCategory: Record<
  ProjectSectionId,
  Array<{ order: number; project: Project }>
> = {
  current: [],
  past: [],
  guided: [],
};

const parseCategory = (entryId: string): ProjectSectionId | null => {
  const [category] = entryId.split("/");

  if (category === "current" || category === "past" || category === "guided") {
    return category;
  }

  return null;
};

const projectEntries = await getCollection("projects");

for (const entry of projectEntries) {
  const category = parseCategory(entry.id);

  if (!category) {
    continue;
  }

  const { order, ...project } = entry.data;
  projectsByCategory[category].push({
    order: order ?? Number.MAX_SAFE_INTEGER,
    project,
  });
}

for (const category of sectionOrder) {
  projectsByCategory[category].sort(
    (a, b) => a.order - b.order || a.project.name.localeCompare(b.project.name),
  );
}

const projectSections = sectionOrder.map((id) => ({
  id,
  title: sectionMeta[id].title,
  description: sectionMeta[id].description,
  projects: projectsByCategory[id].map(({ project }) => project),
}));
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href={iconHref} />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <SEO title={pageTitle} description={pageDescription} />
  </head>
  <body>
    <main class="page home-layout">
      <div class="home-hero page-shell">
        <Nav />

        <header class="intro">
          <span class="intro-header">
            <h1>Zane Olds</h1>
            <span class="subtitle">Teacher, learner, software creator.</span>
            <div>
              Seattle, WA
              <span class="dot">•</span>
              <a href="mailto:zaneolds@gmail.com">zaneolds@gmail.com</a>
            </div>
          </span>
          <div class="copy">
            <p>
              Trained in physics and mathematics with a passion for solving hard
              problems and communicating technical ideas, I’ve spent the last
              few years working as a tutor and teacher of various subjects,
              helping others learn some of the things I know: anything from the
              theorems of calculus and the mysteries of thermodynamics to the
              subtleties of English grammar and the drama of the French
              revolution.
            </p>
            <p>
              My passion for learning brought me to studying foreign languages,
              and then to learning software development to try to make the
              process easier for myself. Now I'm building educational software
              and trying to make learning easier for everyone.
            </p>
          </div>
        </header>
      </div>

      <Projects sections={projectSections} />
    </main>
  </body>
</html>
